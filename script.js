// --- 1. נתוני המשפטים ---
const SENTENCES = {
    "קבוצה 1 – בסיסית מאוד (פתח וקמץ)": [
        "אָבָּא אָכַל לֶחֶם.", "אִמָּא אָפְתָה עוּגָה.", "דָּג שָׂחָה בַּיָּם.",
        "רָן יָשַׁב עַל כִּסֵּא.", "אִמָּא קָרְאָה סֵפֶר.", "דָּנִי רָץ בַּגַּן.",
        "אֲנִי אָכַלְתִּי פַּת.", "אָבָּא אָכַל תַּפּוּחַ.", "הַכֶּלֶב רָץ בַּחָצֵר.",
        "הַיֶּלֶד רָאָה אוֹר.", "יָד עַל שֻׁלְחָן.", "סֵפֶר עַל מִטָּה.",
        "הַכַּד עַל הַשֻּׁלְחָן.", "רוּת אָכְלָה עוּגִיָּה.", "הַדָּג בַּמַּיִם.",
        "הַיֶּלֶד בַּגָּן.", "אָמִיר אָכַל פֶּלַח.", "יָדִי עַל כַּד.",
        "הַחָתוּל עַל הַסַּף.", "אִמָּא שָׁתְתָה מַיִם.", "אָבָּא רָאָה אוֹר גָּדוֹל.",
        "רָן אָכַל בָּנָנָה.", "דָּנָה אָכְלָה עוּגָה.", "יָעֵל רָאָה כֶּלֶב.",
        "אִמָּא קָנְתָה חָלָה.", "הַדֶּגֶל עַל הַמַּטֶּה.", "דָּנָה שָׁחֲקָה בַּכַּד.",
        "אָבָּא יָשַׁב עַל כִּסֵּא.", "הַשֶּׁמֶשׁ זָרְחָה בַּשָּׁמַיִם.", "הַדֶּגֶל יָפֶה מְאוֹד."
    ],
    "קבוצה 2 – קלה (סגול, צרה)": [
        "הַכֶּלֶב יָשֵׁן עַל הַמִּטָּה.", "יָעֵל קָרְאָה סֵפֶר יָפֶה.", "דָּנִי אָכַל תַּפּוּז טָעִים.",
        "רָן מֵנִיף דֶּגֶל יִשְׂרָאֵל.", "הַדָּג שָׂחָה בַּמַּיִם.", "הַחָתוּל קָפַץ עַל הַכִּסֵּא.",
        "אִמָּא שָׁתְתָה מֵי פֶּרַח.", "הַיֶּלֶד נָתַן לֶחֶם לַכֶּלֶב.", "הַשֶּׁמֶשׁ זוֹרַחַת בַּשָּׁמַיִם.",
        "הַצִּפּוֹר עָפָה לַעֵץ.", "הַסֵּפֶר נוֹפֵל מֵהַשֻּׁלְחָן.", "דָּנָה רָקְדָה בַּגָּן.",
        "הַכֶּלֶב אָכַל עוּגָה קְטַנָּה.", "הַכֶּלֶב רָץ אַחֲרֵי הַחָתוּל.", "הַתַּפּוּחַ נָפַל עַל הָאֲדָמָה.",
        "יָעֵל קָרְאָה סֵפֶר גָּדוֹל.", "דָּנִי כָּתַב עִם עֵט.", "הַדָּג שָׂחָה בַּמַּיִם.",
        "הַצִּפּוֹר שָׁרָה בַּבֹּקֶר.", "אָבָּא נָתַן פֶּרַח לְאִמָּא.", "רוּת אָכְלָה גֶּזֶר.",
        "הַיֶּלֶד צָבַע כַּד אָדֹם.", "הַכֶּלֶב יָשַׁב עַל הַשַּׁטִּיחַ.", "יָעֵל רָאָה דָּג גָּדוֹל.",
        "הַתַּפּוּז עָגֹל וְיָפֶה.", "דָּנָה קָפְצָה בַּחוּץ.", "רָן שִׂיחֵק עִם כַּד.",
        "הַדֶּגֶל עָלָה עַל הַמַּטֶּה.", "הַכֶּלֶב קָפַץ בַּגָּן.", "הַצִּפּוֹר עָפָה בַּשָּׁמַיִם."
    ],
    "קבוצה 3 – בינונית (חולם, שורוק, קובוץ)": [
        "הַדּוּב נִרְדַּם בַּיַּעַר.", "הַצִּפּוֹר עָפָה מֵעַל הָעֵץ.", "יָעֵל שָׁתְתָה מַיִם.",
        "הַכֶּלֶב שָׁכַב בַּחוּץ.", "אָבָּא קָנָה פְּרִי בַּשּׁוּק.", "רוּת רָאָה סֵפֶר חָדָשׁ.",
        "הַשֶּׁמֶשׁ זוֹרַחַת בַּבֹּקֶר.", "דָּנָה קָפְצָה עַל הַמִּטָּה.", "הַתַּלְמִיד כָּתַב מִכְתָּב.",
        "הַסֵּפֶר עָמַד עַל הַשֻּׁלְחָן.", "דָּנִי נָתַן פֶּרַח לְאִמּוֹ.", "יָעֵל לָמְדָה עִבְרִית.",
        "רָן נִשְׁכַּב עַל הַמִּטָּה.", "הַדָּג שָׂחָה בַּבָּרֵכָה.", "הַצִּפּוֹר עָפָה בַּשָּׁמַיִם.",
        "דָּנִי שָׁתָה כּוֹס מַיִם.", "אָבָּא קָרָא עִתּוֹן.", "דָּנָה כָּתְבָה בַּמַּחְבֶּרֶת.",
        "רוּת שָׁתְתָה מֵיץ.", "הַתַּלְמִיד שִׁחֵק בַּכַּד.", "יָעֵל אָכְלָה תַּפּוּז.",
        "הַכֶּלֶב שָׁתָה מַיִם.", "הַצִּפּוֹר נָחָה עַל עֵץ.", "רוּת לָבְשָׁה שִׂמְלָה.",
        "יָעֵל רָקְדָה בַּחוּץ.", "דָּנִי שָׂחָה בַּנָּהָר.", "רוּתִי חִבְּקָה דּוּבִי.",
        "דָּנָה רָצָה בַּחוּץ.", "לְיָעֵל יֵשׁ כֶּלֶב קָטָן.", "מַיִם קָרִים וּמְרַעֲנָנִים."
    ],
    "קבוצה 4 – גבוהה (סוף כיתה א׳)": [
        "הַתַּלְמִיד כָּתַב מִכְתָּב יָפֶה.", "יָעֵל וְדָנִי שִׂיחֲקוּ בַּחָצֵר.", "אָבָּא הֵבִיא פֶּרַח לְאִמָּא.",
        "צִפּוֹר עָפָה לַעֵץ גָּבוֹהַּ.", "הַכֶּלֶב הִבִּיט עַל הַדֶּגֶל.", "רָן נָתַן פֶּרַח לְדָנָה.",
        "יָעֵל צִיְּירָה בְּצֶבַע אָדֹם.", "הַתַּלְמִידָה קָרְאָה סֵפֶר גָּדוֹל.", "הַחָתוּל יָשַׁב עַל הַכִּסֵּא.",
        "יֵשׁ בַּסֵּפֶר מִלִּים חֲדָשׁוֹת.", "רוּת הֵכִינָה עוּגָה.", "הַתִּינוֹק שִׂיחֵק עִם חָתוּל.",
        "יָעֵל נָתְנָה פֶּרַח לְרוּת.", "הַשֶּׁמֶשׁ זוֹרַחַת בַּבֹּקֶר.", "דָּנִי הֵבִיא כַּד לְרוּת.",
        "שָׂרָה שָׁרָה שִׁיר בַּבֹּקֶר.", "הַצִּפּוֹר עָפָה מֵעַל הַיָּם.", "בַּיָּם יֵשׁ גַּלִּים.",
        "רוּת מָצְאָה כַּף בַּחוֹל.", "יָעֵל לָמְדָה בַּכִּתָּה.", "אָבָּא שָׂם סֵפֶר עַל הַשֻּׁלְחָן.",
        "הַכֶּלֶב שָׁכַב בַּצֵּל.", "הַיֶּלֶד כָּתַב בַּמַּחְבֶּרֶת.", "הַצִּפּוֹר שָׁרָה בַּעֵץ.",
        "רוּת הֵבִיטָה עַל הַדֶּגֶל.", "צִפּוֹרִים עָפוֹת בַּשָּׁמַיִם.", "הַתַּלְמִיד הֵרִים אֶת הַכַּד.",
        "הַכֶּלֶב שִׂיחֵק בַּחָצֵר.", "הַתַּלְמִידָה כָּתְבָה מִלָּה חֲדָשָׁה.", "יָעֵל וְרוּת צָחֲקוּ בַּגָּן."
    ]
};

// --- 2. משתני מצב ואלמנטים ---
let currentLevelSentences = [];
let currentSentenceIndex = -1;
let currentLevelName = '';

const mainMenuDiv = document.getElementById('main-menu');
const readingScreenDiv = document.getElementById('reading-screen');
const levelInfoDiv = document.getElementById('level-info');
const currentSentenceP = document.getElementById('current-sentence');
const nextSentenceBtn = document.getElementById('next-sentence-btn');
const readAloudBtn = document.getElementById('read-aloud-btn');
const backToMenuBtn = document.getElementById('back-to-menu-btn');

// --- 3. פונקציות לוגיות ---

function shuffleArray(array) {
    // מערבב את רשימת המשפטים
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function showMainMenu() {
    // מציג את מסך בחירת הרמה
    mainMenuDiv.style.display = 'block';
    readingScreenDiv.style.display = 'none';
}

function startReading(levelName) {
    // מתחיל את הקריאה ברמה הנבחרת
    currentLevelName = levelName;
    currentLevelSentences = [...SENTENCES[levelName]]; 
    shuffleArray(currentLevelSentences);
    currentSentenceIndex = -1;
    
    levelInfoDiv.textContent = `רמה נוכחית: ${currentLevelName}`;
    mainMenuDiv.style.display = 'none';
    readingScreenDiv.style.display = 'block';
    nextSentence();
}

function nextSentence() {
    // עובר למשפט הבא
    currentSentenceIndex++;
    if (currentSentenceIndex < currentLevelSentences.length) {
        currentSentenceP.textContent = currentLevelSentences[currentSentenceIndex];
    } else {
        alert(`🎉 כל הכבוד! סיימת את כל המשפטים ב'רמה: ${currentLevelName}'! 🎉`);
        showMainMenu();
    }
}

function readAloud() {
    // מפעיל קריאה קולית (Web Speech API)
    if ('speechSynthesis' in window) {
        const sentence = currentSentenceP.textContent;
        const utterance = new SpeechSynthesisUtterance(sentence);
        // מנסה להגדיר עברית
        utterance.lang = 'he-IL'; 
        speechSynthesis.speak(utterance);
    } else {
        alert("הדפדפן שלך לא תומך בקריאת טקסט אוטומטית. נסה דפדפן אחר (כרום/ספארי).");
    }
}

// --- 4. פונקציית אתחול ---
function initializeApp() {
    const levelsContainer = mainMenuDiv;
    // יצירת כפתור לכל רמה באופן דינמי
    Object.keys(SENTENCES).forEach(levelName => {
        const button = document.createElement('button');
        button.textContent = levelName;
        button.className = 'level-btn';
        button.onclick = () => startReading(levelName);
        levelsContainer.appendChild(button);
    });
    
    // הגדרת מאזינים לאירועים בכפתורים
    nextSentenceBtn.onclick = nextSentence;
    readAloudBtn.onclick = readAloud;
    backToMenuBtn.onclick = showMainMenu;

    showMainMenu();
}

window.onload = initializeApp;